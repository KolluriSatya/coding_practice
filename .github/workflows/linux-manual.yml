on:
  workflow_dispatch

name: manual release linux

jobs:
  conda-linux:
    name: Linux Upload
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v1
      - name: Make conda yaml
        run: |
          pip install PyYAML
          pip install ruamel.yaml
          python conda/make_conda.py
          cat conda/meta.yaml
      - name: build conda package
        uses: mamba-org/setup-micromamba@v1
        with:
          environment-file: envs/linux-build.yml          
      - name: publish-to-conda-linux
        uses: BEFH/anaconda-publish@v1.5.1
        with:
          subDir: 'conda'
          channels: 'conda-forge -c cctbx202211 -c cctbx202208 -c genomicepidemiology'
          AnacondaToken: ${{ secrets.SATYA_CONDA_AUTH_TOKEN }}
          publish: true
